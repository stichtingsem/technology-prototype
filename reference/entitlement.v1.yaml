openapi: 3.0.0
info:
  title: entitlement.v1
  version: '1.0'
  description: |-
    This is an API provided by the Marketplace in the SEM ecosystem, and is designed to enable a marketplace to make information about products that have been selected or purchased by a school or individual to be then added automatically into the LMS of the school, as well as be used by the specific Learning Application that has been purchased to ensure that all setup and provisioning has been completed in advance of access.

    Events generated by the Entitlement API are connected to state changes.

     - `mp.entitlement.active` - First created and active
     - `mp.entitlement.refunded` - Refunded
     - `mp.entitlement.updated` - Modified in any other way
servers:
  - url: 'https://example.stichtingsem.org/api'
    description: entitlement
paths:
  '/entitlements/{id}':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: Specific identifier of an entitlement.
    get:
      summary: Your GET endpoint
      tags: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Entitlement'
      operationId: get-entitlements-by-id
      description: Retrieve the full specification for an entitlement from a marketplace.
  /entitlements/vendor:
    parameters: []
    get:
      summary: Your GET endpoint
      tags: []
      responses:
        '200':
          description: OK
      operationId: get-entitlements-vendor-id
      security:
        - API Key - 1:
            - mp.entitlements.vendor
      description: 'Get all entitlements related to products from a specific vendor.  It is assumed that at the point of setup and provision of an API key, that the Vendor name is also stored against the API key by the marketplace, so that all calls with this key will be filtered to that specific vendor in the response.'
  '/entitlements/school/{id}':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: School identifier.
    get:
      summary: Your GET endpoint
      tags: []
      responses: {}
      operationId: get-entitlements-school-id
      security:
        - API Key - 1:
            - mp.entitlements.school
      description: 'Retrieve all entilements for a specific school, the school will have approved the LMS to have access to its Marketplace during the setup phase.'
components:
  schemas:
    Entitlement:
      title: Entitlement
      type: object
      description: 'The core object that expresses information about a product that a school or indivdiual has selected for use - typically via a LML, but not always.'
      properties:
        start:
          type: string
          format: date
          example: '2021-08-22'
        end:
          type: string
          format: date
        product:
          $ref: '#/components/schemas/Product'
        entitlee:
          oneOf:
            - $ref: '#/components/schemas/School'
            - $ref: '#/components/schemas/Individual'
        model:
          $ref: '#/components/schemas/BusinessModel'
        quantity:
          type: integer
          example: 100
          format: int32
          description: ''
        id:
          type: string
          example: 24e39454-5360-4ba4-819f-03e59b8dd679
        status:
          type: string
          example: live
          description: 'The status of the entitlement '
          enum:
            - refunded
            - active
          default: active
      required:
        - start
        - end
        - product
        - entitlee
        - model
        - id
        - status
    Product:
      title: Product
      type: object
      description: A product that can be accessed after being purchased or selected.
      properties:
        ean:
          type: string
        name:
          type: string
        url:
          type: string
        vendor:
          type: string
          description: 'Short name for a specific vendor, established (along with the vendor secret) at the point of setup.'
          example: e8346234-6bda-4c07-ab2e-a687a94430b2
      required:
        - ean
        - name
        - url
        - vendor
    School:
      title: School
      type: object
      properties:
        id:
          type: string
          description: |
            The ID for the school (RIO?)
        name:
          type: string
          description: The name for the school
        group:
          type: array
          items:
            $ref: '#/components/schemas/Group'
        quantity:
          type: integer
          example: 100
          description: 'Quantity available to the school, used if no group selected.'
      required:
        - id
        - name
    Individual:
      title: Individual
      type: object
      description: Information about an individual who has an entitlement to use a specific product that they have purchased or selected.
      properties:
        id:
          type: string
          description: |
            A unique identifier for the purchaser.
        name:
          type: string
          description: The name of the person purchasing.
        email:
          type: string
          description: 'The email address of the person purchasing, used to notify the individual of fulfilment and provide access.'
        eck-id:
          type: string
          description: 'If needed, the ECK-ID of the individual.'
      required:
        - id
        - name
        - email
    BusinessModel:
      title: BusinessModel
      type: object
      description: 'The model under which the entitlement has been granted, possible business models per product can be exchanged with the Marketplace by the Learning Application provider.'
      properties:
        id:
          type: string
          description: Unique identifier of the business model recognised by both the marketplace and the learning application.
          example: 24e39454-5360-4ba4-819f-03e59b8dd679
        name:
          type: string
          description: |
            A description of the business model so it can be displayed in the Marketplace or LMS if needed.
          example: pre-pay
        description:
          type: string
          description: A longer description of the business model.
          example: 'Pre-Pay: This product must be paid for before it can be used.'
      required:
        - id
        - name
    Group:
      title: Group
      type: object
      description: A sub-group within a school that the entitlement is applicable to.
      properties:
        standard_subject_code:
          type: string
          description: Government standard subject code.
        standard_level:
          type: string
          description: Government standard level.
        quantity:
          type: integer
          example: 100
          description: Quantity selected or purchased.
        school_subject_code:
          type: string
          description: 'School description of this subject, may differ from standard.'
        school_level:
          type: string
          description: 'School description of this level, may differ from standard.'
      required:
        - standard_subject_code
        - standard_level
    Entitlements:
      title: Entitlements
      type: array
      items:
        $ref: '#/components/schemas/Entitlement'
      description: This is a list of entitlements that can be made available or retrieve in bulk.
  securitySchemes:
    API Key - 1:
      type: oauth2
      flows:
        implicit:
          authorizationUrl: ''
          scopes:
            mp.entitlements.school: Can see all entitlements created for a specific school regardless of vendor (e.g. a LMS)
            mp.entitlements.vendor: Can see all entitlements created for products that you sell in the Marketplace (e.g. a LA)
